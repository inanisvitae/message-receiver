"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _intercomClient=require("intercom-client"),_config=require("config"),_config2=_interopRequireDefault(_config),_bunyan=require("bunyan"),_bunyan2=_interopRequireDefault(_bunyan);const log=_bunyan2.default.createLogger({name:"orderDeletePendingOrder"}),client=new _intercomClient.Client(_config2.default.get("thirdPartyPlatform.intercom")),deletePendingOrder=e=>{e.assertQueue("ORDER:DELETE_PENDING_ORDER",{durable:!0}),e.consume("ORDER:DELETE_PENDING_ORDER",e=>{const t=JSON.parse(e.content).customer_id;client.users.find({user_id:t}).then(e=>{const n={status_num_pending:e.body.custom_attributes.status_num_pending-1,status_num_pending_deleted:e.body.custom_attributes.status_num_pending_deleted+1};client.users.update({user_id:t,custom_attributes:n}).catch(e=>{log.info(e)})}).catch(e=>{log.info(e)})},{noAck:!0})};exports.default=(e=>{e.assertQueue("ORDER:DELETE_PENDING_ORDER",{durable:!0}),e.consume("ORDER:DELETE_PENDING_ORDER",e=>{const t=JSON.parse(e.content).customer_id;client.users.find({user_id:t}).then(e=>{const n={status_num_pending:e.body.custom_attributes.status_num_pending-1,status_num_pending_deleted:e.body.custom_attributes.status_num_pending_deleted+1};client.users.update({user_id:t,custom_attributes:n}).catch(e=>{log.info(e)})}).catch(e=>{log.info(e)})},{noAck:!0})});
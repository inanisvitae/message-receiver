"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _intercomClient=require("intercom-client"),_config=require("config"),_config2=_interopRequireDefault(_config),_bunyan=require("bunyan"),_bunyan2=_interopRequireDefault(_bunyan);const log=_bunyan2.default.createLogger({name:"customerUpdateCustomerInfo"}),client=new _intercomClient.Client(_config2.default.get("thirdPartyPlatform.intercom")),updateCustomerInfo=e=>{e.assertQueue("CUSTOMER:UPDATE_CUSTOMER_INFO",{durable:!0}),e.consume("CUSTOMER:UPDATE_CUSTOMER_INFO",e=>{const t=JSON.parse(e.content),n=t.data,i=t.id;if(n.mobile&&client.users.update({user_id:i,phone:n.mobile}).catch(e=>{log.info(e)}),n.email&&client.users.update({user_id:i,email:n.email}).catch(e=>{log.info(e)}),n.first_name||n.last_name){const e=`${n.first_name} ${n.last_name}`.trim();client.users.update({user_id:i,name:e}).catch(e=>{log.info(e)})}if(n.tpp_type)try{const e={};e[`is_oauth_${n.tpp_type.toLowerCase()}`]=!0,client.users.update({user_id:i,custom_attributes:e}).catch(e=>{log.info(e)})}catch(e){log.info("Unable to change tpp_type")}})};exports.default=(e=>{e.assertQueue("CUSTOMER:UPDATE_CUSTOMER_INFO",{durable:!0}),e.consume("CUSTOMER:UPDATE_CUSTOMER_INFO",e=>{const t=JSON.parse(e.content),n=t.data,i=t.id;if(n.mobile&&client.users.update({user_id:i,phone:n.mobile}).catch(e=>{log.info(e)}),n.email&&client.users.update({user_id:i,email:n.email}).catch(e=>{log.info(e)}),n.first_name||n.last_name){const e=`${n.first_name} ${n.last_name}`.trim();client.users.update({user_id:i,name:e}).catch(e=>{log.info(e)})}if(n.tpp_type)try{const e={};e[`is_oauth_${n.tpp_type.toLowerCase()}`]=!0,client.users.update({user_id:i,custom_attributes:e}).catch(e=>{log.info(e)})}catch(e){log.info("Unable to change tpp_type")}})});